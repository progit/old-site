---
layout: translation
title: Pro Git 4.2 Git サーバ サーバ用の Git の取得
---
<h2 id='_git_'>サーバ用の Git の取得</h2>

<p>Git サーバを立ち上げるには、既存のリポジトリをエクスポートして新たなベアリポジトリ (作業ディレクトリを持たないリポジトリ) を作らなければなりません。これは簡単にできます。リポジトリをクローンして新たにベアリポジトリを作成するには、clone コマンドでオプション <code>--bare</code> を指定します。慣例により、ベアリポジトリのディレクトリ名の最後は <code>.git</code> とすることになっています。</p>

<pre><code>$ git clone --bare my_project my_project.git
Initialized empty Git repository in /opt/projects/my_project.git/</code></pre>

<p>このコマンドを実行したときの出力はちょっとわかりにくいかもしれません。<code>clone</code> は基本的に <code>git init</code> をしてから <code>git fetch</code> をするのと同じことなので、<code>git init</code> の部分の部分の出力も見ることになります。そのメッセージは「空のディレクトリを作成しました」というものです。実際にどんなオブジェクトの転送が行われたのかは何も表示されませんが、きちんと転送は行われています。これで、<code>my_project.git</code> ディレクトリに Git リポジトリのデータができあがりました。</p>

<p>これは、おおざっぱに言うと次の操作と同じようなことです。</p>

<pre><code>$ cp -Rf my_project/.git my_project.git</code></pre>

<p>設定ファイルにはちょっとした違いもありますが、ほぼこんなものです。作業ディレクトリなしで Git リポジトリを受け取り、それ単体のディレクトリを作成しました。</p>

<h3 id='id79'>ベアリポジトリのサーバ上への設置</h3>

<p>ベアリポジトリを取得できたので、あとはそれをサーバ上においてプロトコルを準備するだけです。ここでは、<code>git.example.com</code> というサーバがあってそこに SSH でアクセスできるものと仮定しましょう。Git リポジトリはサーバ上の <code>/opt/git</code> ディレクトリに置く予定です。新しいリポジトリを作成するには、ベアリポジトリを次のようにコピーします。</p>

<pre><code>$ scp -r my_project.git user@git.example.com:/opt/git</code></pre>

<p>この時点で、同じサーバに SSH でアクセスできてかつ <code>/opt/git</code> ディレクトリへの読み込みアクセス権限がある人なら、次のようにしてこのリポジトリをクローンできるようになりました。</p>

<pre><code>$ git clone user@git.example.com:/opt/git/my_project.git</code></pre>

<p>ユーザが SSH でアクセスでき、かつ <code>/opt/git/my_project.git</code> ディレクトリへの書き込みアクセス権限があれば、すでにプッシュもできる状態になっています。<code>git init</code> コマンドで <code>--shared</code> オプションを指定すると、リポジトリに対するグループ書き込みパーミッションを自動的に追加することができます。</p>

<pre><code>$ ssh user@git.example.com
$ cd /opt/git/my_project.git
$ git init --bare --shared</code></pre>

<p>既存の Git リポジトリからベアリポジトリを作成し、メンバーが SSH でアクセスできるサーバにそれを配置するだけ。簡単ですね。これで、そのプロジェクトでの共同作業ができるようになりました。</p>

<p>複数名が使用する Git サーバをたったこれだけの作業で用意できるというのは特筆すべきことです。サーバ SSH アクセス可能なアカウントを作成し、ベアリポジトリをサーバのどこかに置き、そこに読み書き可能なアクセス権を設定する。これで準備OK。他には何もいりません。</p>

<p>次のいくつかのセクションでは、より洗練された環境を作るための方法を説明します。いちいちユーザごとにアカウントを作らなくて済む方法、一般向けにリポジトリへの読み込みアクセスを開放する方法、ウェブ UI の設定、Gitosis の使い方などです。しかし、数名のメンバーで閉じたプロジェクトでの作業なら、SSH サーバとベアリポジトリ <em>さえ</em> あれば十分なことは覚えておきましょう。</p>

<h3 id='id80'>ちょっとしたセットアップ</h3>

<p>小規模なグループ、あるいは数名の開発者しかいない組織で Git を使うなら、すべてはシンプルに進められます。Git サーバを準備する上でもっとも複雑なことのひとつは、ユーザ管理です。同一リポジトリに対して「このユーザは読み込みのみが可能、あのユーザは読み書きともに可能」などと設定したければ、アクセス権とパーミッションの設定は多少難しくなります。</p>

<h4 id='ssh_'>SSH アクセス</h4>

<p>開発者全員が SSH でアクセスできるサーバがすでにあるのなら、リポジトリを用意するのは簡単です。先ほど説明したように、ほとんど何もする必要はないでしょう。より複雑なアクセス制御をリポジトリ上で行いたい場合は、そのサーバの OS 上でファイルシステムのパーミッションを設定するとよいでしょう。</p>

<p>リポジトリに対する書き込みアクセスをさせたいメンバーの中にサーバのアカウントを持っていない人がいる場合は、新たに SSH アカウントを作成しなければなりません。あなたがサーバにアクセスできているということは、すでに SSH サーバはインストールされているということです。</p>

<p>その状態で、チームの全員にアクセス権限を与えるにはいくつかの方法があります。ひとつは全員分のアカウントを作成すること。直感的ですがすこし面倒です。ひとりひとりに対して <code>adduser</code> を実行して初期パスワードを設定するという作業をしなければなりません。</p>

<p>もうひとつの方法は、&#8217;git&#8217; ユーザをサーバ上に作成し、書き込みアクセスが必要なユーザには SSH 公開鍵を用意してもらってそれを &#8216;git&#8217; ユーザの <code>~/.ssh/authorized_keys</code> に追加します。これで、全員が &#8216;git&#8217; ユーザでそのマシンにアクセスできるようになりました。これがコミットデータに影響を及ぼすことはありません。SSH で接続したときのユーザとコミットするときに記録されるユーザとは別のものだからです。</p>

<p>あるいは、SSH サーバの認証を LDAP サーバやその他の中央管理形式の仕組みなど既に用意されているものにするとこもできます。各ユーザがサーバ上でシェルへのアクセスができさえすれば、どんな仕組みの SSH 認証であっても動作します。</p>

<div id='nav'>
<a href='ch4-1.html'>prev</a> | <a href='ch4-3.html'>next</a>
</div>